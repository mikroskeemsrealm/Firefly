From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mark Vainomaa <mikroskeem@mikroskeem.eu>
Date: Thu, 26 Sep 2019 17:39:53 +0300
Subject: [PATCH] Add ServerPing serializer


diff --git a/proxy/src/main/java/eu/mikroskeem/mikrocord/gson/ServerPingSerializer.java b/proxy/src/main/java/eu/mikroskeem/mikrocord/gson/ServerPingSerializer.java
new file mode 100644
index 0000000000000000000000000000000000000000..54e54a1115bc1bd62797ba07f171c8d30c87b255
--- /dev/null
+++ b/proxy/src/main/java/eu/mikroskeem/mikrocord/gson/ServerPingSerializer.java
@@ -0,0 +1,35 @@
+package eu.mikroskeem.mikrocord.gson;
+
+import com.google.gson.JsonElement;
+import com.google.gson.JsonObject;
+import com.google.gson.JsonSerializationContext;
+import com.google.gson.JsonSerializer;
+import net.md_5.bungee.api.ServerPing;
+
+import java.lang.reflect.Type;
+
+/**
+ * @author Mark Vainomaa
+ */
+public final class ServerPingSerializer implements JsonSerializer<ServerPing> {
+    @Override
+    public JsonElement serialize(ServerPing src, Type typeOfSrc, JsonSerializationContext context) {
+        JsonObject root = new JsonObject();
+        root.add("description", context.serialize(src.getDescriptionComponent()));
+        root.add("favicon", context.serialize(src.getFaviconObject()));
+        root.add("modinfo", context.serialize(src.getModinfo()));
+
+        JsonObject version = new JsonObject();
+        version.addProperty("name", src.getVersion().getName());
+        version.addProperty("protocol", src.getVersion().getProtocol());
+        root.add("version", version);
+
+        JsonObject players = new JsonObject();
+        players.addProperty("max", src.getPlayers().getMax());
+        players.addProperty("online", src.getPlayers().getOnline());
+        players.add("sample", context.serialize(src.getPlayers().getSample()));
+        root.add("players", players);
+
+        return root;
+    }
+}
diff --git a/proxy/src/main/java/net/md_5/bungee/BungeeCord.java b/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
index f76ad5f4a1fc43069706869e40d47e29b993c7a7..bf1256a7e713538716632be04752b82fcead95b5 100644
--- a/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
+++ b/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
@@ -161,6 +161,7 @@ public class BungeeCord extends ProxyServer
             .registerTypeAdapter( KeybindComponent.class, new KeybindComponentSerializer() )
             .registerTypeAdapter( ScoreComponent.class, new ScoreComponentSerializer() )
             .registerTypeAdapter( SelectorComponent.class, new SelectorComponentSerializer() )
+            .registerTypeAdapter(ServerPing.class, new eu.mikroskeem.mikrocord.gson.ServerPingSerializer()) // MikroCord - add ServerPing serializer
             .registerTypeAdapter( ServerPing.PlayerInfo.class, new PlayerInfoSerializer() )
             .registerTypeAdapter( Favicon.class, Favicon.getFaviconTypeAdapter() ).create();
     @Getter
